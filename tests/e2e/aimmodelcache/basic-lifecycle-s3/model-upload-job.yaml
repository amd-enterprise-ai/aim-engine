apiVersion: batch/v1
kind: Job
metadata:
  name: model-upload
spec:
  template:
    spec:
      restartPolicy: OnFailure
      initContainers:
      - name: downloader
        image: kserve/storage-initializer:v0.16.0
        args:
        - "hf://HuggingFaceTB/SmolLM-135M"
        - "/mnt/models"
        volumeMounts:
        - name: model-storage
          mountPath: /mnt/models
      containers:
      - name: uploader
        image: minio/mc:latest
        command:
        - /bin/sh
        - -c
        - |
          #!/bin/sh
          set -e
          echo "Configuring Minio client..."
          mc alias set myminio http://minio:9000 minioadmin minioadmin

          echo "Uploading model to Minio..."
          mc cp --recursive /mnt/models/ myminio/models/SmolLM-135M/
          echo "Upload complete"
        volumeMounts:
        - name: model-storage
          mountPath: /mnt/models
      volumes:
      - name: model-storage
        emptyDir: {}
